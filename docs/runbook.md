# Runbook

## 1. Запуск окружения (dev)
- Поднять Postgres, Redis, S3-compatible.
- Запустить API и Worker.
- Запустить Ollama (если локальный LLM).
- Проверить health endpoints.

## 2. Типовые инциденты
**Очереди растут, воркеры не успевают**
- Проверить лимиты параллельности.
- Увеличить воркеры для `asr` и `compose`.
- Проверить доступность ASR/LLM.

**Ошибки `LIMIT_EXCEEDED`**
- Проверить конфиг лимитов.
- Убедиться, что лимиты синхронизированы между API и воркерами.

**Сбой локальных моделей**
- Проверить наличие модели на диске.
- Проверить доступность GPU/CPU и лимиты памяти.
- Переключить provider на `remote` (если разрешено).

## 3. Мониторинг
- Метрики: длительность ASR, сегментации, кадрирования, экспорта.
- Ошибки: рост `failed` и `retrying`.
- Доля успешных пайплайнов.

## 4. Ротация и ретенция
- Периодические джобы для удаления raw/кадров/экспортов.
- Контроль объема storage.

## 5. Восстановление после сбоев
**Потеря воркеров**
- Перезапустить воркеры и проверить очереди на зависшие задачи.
- Запустить replay задач со статусом `retrying`.

**Повреждение артефактов в storage**
- Повторно сгенерировать кадры и экспорты из транскриптов.
- Если raw недоступен — пометить гайд как требующий ручной проверки.

**Сбой БД**
- Восстановить из последнего бэкапа.
- Проверить консистентность статусов видео и гайдов.
